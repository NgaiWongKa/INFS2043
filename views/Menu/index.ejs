<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/CSS/font-awesome.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
    <link rel="icon" href="https://ld-wp.template-help.com/wordpress_prod-22160/v1/wp-content/uploads/2019/02/cropped-favicon-32x32.png" sizes="32x32" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/CSS/base.css" />
    <link rel="stylesheet" href="/CSS/menu_index.css" />
    <style>
        .img-container {
            position: relative;
            display: inline-block;
        }

        .img-container img {
            display: block
        }

        .img-container .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .overlay span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
        }
    </style>
    <title>Food Menu</title>
</head>

<body>

    <!---------NAVBAR---------->
    <section class="header-container">
        <div class="header-container-flex-desktop">
            <div class="Logo-desktop">
                <a href="/home"><img src="./images/logo.png" alt="" /></a>
            </div>
            <div class="menubar-pc">
                <a class="item" href="/home"><span>Home</span></a>

                <% if (!isAuthenticated) { %>
                  <a class="item" href="/login"><span>Login</span></a>
                  <a class="item" href="/register"><span>Register</span></a>
                <% } else { %>
                  <% if (currentUser.type === 'staff') { %>
                    <a href="/order/staff" class="item">View Pending Orders</a>
                <% } %>
                  <a class="item" href="/menu"><span>Menu</span></a>
                  <a class="item" href="/profile"><span>Profile</span></a>
                  <a class="item" href="/logout"><span>Log out</span></a>
                  <a class="item" href="/order/pending"><span>Pending</span></a>
                <% } %>
                <a class="item" href="/GPS"><span>GPS</span></a>
            </div>

    </section>
    <!-------------------------->

    <!---------FUEL SECTION---------->
    <div class="container mt-5">
        <div class="card mb-3">
            <div class="card-header">
                <h2>Fuel Payment and Pump Reservation</h2>
            </div>
            <div class="card-body">
                <form id="fuel-form">
                    <div class="form-group">
                        <label for="fuelType">Fuel Type:</label>
                        <select id="fuelType" name="fuelType" class="form-control">
                            <option value="Ethanol 85" <%= currentUser.prefFuel === 'Ethanol 85' ? 'selected' : '' %>>Ethanol 85</option>
                            <option value="Diesel" <%= currentUser.prefFuel === 'Diesel' ? 'selected' : '' %>>Diesel</option>
                            <option value="Premium 95" <%= currentUser.prefFuel === 'Premium 95' ? 'selected' : '' %>>Premium 95</option>
                            <option value="Unleaded 91" <%= currentUser.prefFuel === 'Unleaded 91' ? 'selected' : '' %>>Unleaded 91</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="amount">Amount (Liters):</label>
                        <input type="number" id="amount" name="amount" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Pay for Fuel</button>
                </form>
                <div id="pump-info" class="mt-3"></div>
            </div>
        </div>
    </div>
    <!-------------------------->

    <!---------MAIN CONTENT---------->
    <div class="container mt-5">
        <div class="img-container mb-3">
            <img src="/extra_images/food_menu_banner.jpg" class="img-fluid rounded" alt="A food menu's banner image" style="width: 100%; height: 18rem; overflow: hidden;">
            <div class="overlay">
                <span>
                    <h1 class="mb-4 text-center" style="font-family:Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;color: #fff;font-size: 600%; text-shadow: rgb(0, 0, 0) 1px 0 100px;">FOOD MENU</h1>
                </span>
            </div>
        </div>
        <% if (currentUser.type == "staff") { %>
        <a href="/menu/new" class="btn btn-success mb-3">Add New Item</a>
        <% } %>
        <a href="/cart" class="btn btn-primary mb-3">View Cart</a>
        <div class="row">
            <% menuItems.forEach(item => { %>
            <div class="col-md-4 mb-4">
                <div class="card border-secondary shadow rounded">
                    <div class="text-center m-3">
                        <img src="/food_items/<%= item.image %>" class="card-img-top" alt="<%= item.name %>" style="width:75%;height: auto;">
                    </div>
                    <div class="card-body">
                        <h3 class="card-title"><%= item.name %></h5>
                        <p class="card-text text-truncate"><%= item.description %></p>
                        <p class="card-text">Price: $<%= item.price.toFixed(2) %></p>
                        <form class="add-to-cart-form" data-id="<%= item._id %>">
                            <div class="form-group">
                                <label for="quantity">Quantity:</label>
                                <input type="number" name="quantity" class="form-control" value="1" min="1">
                            </div>
                            <button type="submit" class="btn btn-success btn-block">Add to Cart</button>
                        </form>
                        <% if (currentUser.type == "staff") { %>
                        <a href="/menu/<%= item._id %>/edit" class="btn btn-outline-warning btn-block mt-2">Edit</a>
                        <form action="/menu/<%= item._id %>?_method=DELETE" method="POST" class="mt-2">
                            <button type="submit" class="btn btn-outline-danger btn-block">Delete</button>
                        </form>
                        <% } %>
                    </div>
                </div>
            </div>
            <% }); %>
        </div>
    </div>
    <!-------------------------->

    <!---------FOOTER---------->
    <section class="footer-container">
        <div class="footer-content">
            <div class="footer-item">
                <div class="footer-title">Address</div>
                <div class="footer-item-content">
                    <br /> Mawson Lakes Blvd, Mawson Lakes SA 5095
                </div>
            </div>
            <div class="footer-item">
                <div class="footer-title">Follow us</div>
                <div class="footer-item-content" id="icon-box">
                    <a href="https://www.facebook.com" target="_blank"><i class="fa-brands fa-facebook-f"></i></a>
                    <a href="https://www.twitter.com" target="_blank"><i class="fa-brands fa-twitter"></i></a>
                    <a href="https://www.google.com" target="_blank"><i class="fa-brands fa-google"></i></a>
                    <a href="https://www.linkedin.com" target="_blank"><i class="fa-brands fa-linkedin"></i></a>
                    <a href="https://www.pinterest.com" target="_blank"><i class="fa-brands fa-pinterest"></i></a>
                </div>
            </div>
            <div class="footer-item">
                <div class="footer-title">Contact us</div>
                <div class="footer-item-content">
                    <a href="callto:+1 800 603 6035">+61 47 369 6999</a><br />
                    <a href="callto:+1 800 603 6035">+61 47 369 6969</a><br />
                    <a href="mailto:mail@demolink.org">UTRmail@demolink.org</a>
                </div>
            </div>
        </div>
    </section>
    <!-------------------------->

    <script async src="https://cdn.jsdelivr.net/npm/es-module-shims@1/dist/es-module-shims.min.js" crossorigin="anonymous"></script>
    <script type="importmap">
    {
      "imports": {
        "@popperjs/core": "https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/esm/popper.min.js",
        "bootstrap": "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.esm.min.js"
      }
    }
    </script>
    <script type="module">
      import * as bootstrap from 'bootstrap'

      new bootstrap.Popover(document.getElementById('popoverButton'))
    </script>
    <script>
        $(document).ready(function() {
            $('.add-to-cart-form').on('submit', function(e) {
                e.preventDefault();
                var form = $(this);
                var itemId = form.data('id');
                var quantity = form.find('input[name="quantity"]').val();
                $.ajax({
                    url: '/cart/add/' + itemId,
                    type: 'POST',
                    data: {
                        quantity: quantity
                    },
                    success: function(response) {
                        alert('Item added to cart!');
                    },
                    error: function(error) {
                        alert('Error adding item to cart.');
                    }
                });
            });

            $('#fuel-form').on('submit', function(e) {
                e.preventDefault();
                var fuelType = $('#fuelType').val();
                var amount = $('#amount').val();
                $.ajax({
                    url: '/fuel/pay',
                    type: 'POST',
                    data: {
                        fuelType: fuelType,
                        amount: amount
                    },
                    success: function(response) {
                        $('#pump-info').html('<p>Reserved Pump: ' + response.pump + '</p>');
                    },
                    error: function(error) {
                        alert('Error processing fuel payment.');
                    }
                });
            });
        });
    </script>
</body>

</html>